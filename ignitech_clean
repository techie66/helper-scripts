#!/bin/bash

# Make a backup
cp $1 $1.save

# Cuts timestamps out
cat $1 |sed  '/^<\|>\|-/d' > $1.cut

# Keep only the data columns
cat $1.cut|cut -c1-48 >$1.ws

# trim whitespace
cat $1.ws | tr -d '[:space:]' > $1.asciihex

# split text into one message per line )2 part)
cat $1.asciihex | sed 's/300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005897/\n300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005897\n/g' >$1.split1
cat $1.split1 | sed '/^$/d'> $1.all_messages

# remove short lines
sed -i -r '/^.{,203}$/d' $1.all_messages

# trim whitespace
cat $1.all_messages | tr -d '[:space:]' > $1.asciihex

# make into straight binary file
cat $1.asciihex | xxd -r -p >$1.bin

cat $1.all_messages | sed '/300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005897/d' >$1.from_unit
rm $1.split1 $1.asciihex $1.ws $1.cut

